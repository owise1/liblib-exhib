var _pl={db:"liblib",design:"liblib-exhib"};window.URL=window.URL||window.webkitURL;var LibLibExhibApp=angular.module("LibLibExhibApp",["CornerCouch"]).config(["$compileProvider",function(i){var n=/^\s*(https?|blob):/;i.aHrefSanitizationWhitelist(n),i.imgSrcSanitizationWhitelist(n)}]);LibLibExhibApp.controller("ListingCtrl",["$scope","$http","cornercouch",function(i,n,e){function o(){i.db.query(c.design,"media",{reduce:!1,limit:10,include_docs:!0}).success(function(n){i.medias=n.rows.map(R.prop("doc")).map(t)})}function t(i){return i._attachments&&angular.forEach(i._attachments,function(n,e){/^cover\./.test(e)?i.coverImg="/"+c.db+"/"+i._id+"/"+e:(i.media=n,i.media.url="/"+c.db+"/"+i._id+"/"+e)}),i}var c=window._pl;i.db=e().getDB(c.db),i.upload=function(n){for(var e,t=[],c=0;e=n.files[c];c++)t.push(e);t.forEach(function(n){var e=i.db.newDoc({name:n.name,content_type:n.type});e.save().success(function(){e.attach(n,n.name,o)})})},i.del=function(n){i.db.newDoc(n).remove().success(o)},i.save=function(n){i.db.newDoc(n).save().success(o)},o()}]);